#!/usr/bin/env bash

set -eu

me=${0##*/}
usage="Interact with a snippet using dmenu.

Usage: $me [-h] [-ecst]

Options:
    -h    show this help message
    -e    edit snippet in preferred editor
    -c    copy snippet to clipboard
    -s    save clipboard to snippet 
    -t    type snippet in active window
    -d    delete snippet
"

usage() {
    echo "$usage" >&2
    exit 0
}

die() {
    echo "$me: $*" >&2
    exit 1
}

declare -A option_names
option_names["e"]="edit"
option_names["c"]="copy"
option_names["s"]="save"
option_names["t"]="type"
option_names["d"]="delete"

unset OPTIND OPTARG
while getopts ":hecstd" option; do
    case $option in
    h) usage ;;
    e | c | s | t | d) snip_option=$option ;;
    *) die "invalid option: $OPTARG" ;;
    esac
done && shift $((OPTIND - 1))
unset option OPTIND OPTARG

[[ -z $snip_option ]] && die "no snippet action provided"

name=$(snip -l | rofi -dmenu -p "${option_names[$snip_option]} snippet")

[[ -z $name ]] && die "no snippet selected"

snip -"$snip_option" "$name"
