#!/usr/bin/env bash

# Set the audio volume and show a notification.

set -eu

action=${1:?Missing action}

increment=5

case $action in
mute) pamixer --toggle-mute ;;
down) pamixer --decrease $increment ;;
up) pamixer --increase $increment ;;
max) pamixer --set-volume 100 ;;
[0-9]*) pamixer --set-volume "$action" ;;
esac

# The exit code corresponds to mute status.
muted=$(pamixer --get-mute) || true # -e will cause exit otherwise

volume=$(pamixer --get-volume)

canberra-gtk-play -i message &

if [[ $muted == true ]]; then
    icon="audio-volume-muted"
else
    icon="audio-volume-high"
fi

notify-send -u low -i "$icon" -h int:value:"$volume" \
    -h string:x-canonical-private-synchronous:audio-volume \
    "Volume Control" "Volume: $volume%"
