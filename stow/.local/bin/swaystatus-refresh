#!/usr/bin/env bash

# The following lock file guard along with the sleep command defined at the end
# of the script will limit how often swaystatus can be refreshed. Sending the
# refresh signal too frequently seemed to be crashing it.

set -eu

lock_file=$XDG_RUNTIME_DIR/${0##*/}.lock

if [[ -e $lock_file ]]; then
    exit 0
fi

touch "$lock_file"
trap 'rm "$lock_file"' INT TERM EXIT

killall -SIGUSR1 swaystatus

sleep 0.1
