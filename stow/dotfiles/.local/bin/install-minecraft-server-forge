#!/usr/bin/env bash

# Install and configure a minecraft forge server.

set -e

version=${1:-$(minecraft-version-latest)}

dir=${dir:-$HOME/.minecraft-server}

mkdir -p "$dir"; cd "$dir"

installer=forge-$version-installer.jar
build=$(get-minecraft-forge "$version" installer)

test -f "$installer" || ln -sfv "$build" "$installer"

if ! test -f "$installer"; then
    echo "Unable to download installer for $version" >&2
    exit 1
fi

universal=${build/installer/universal}
forge=forge-$version.jar

test -f "$universal" || java -jar "$installer" --installServer

ln -sfv "$universal" "$forge"
ln -sfv "$forge" forge.jar
ln -sfv forge.jar server.jar

echo "eula=true" >eula.txt
echo stop | java -jar forge.jar nogui

echo "Run $dir/server to start" >&2
