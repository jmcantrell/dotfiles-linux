#!/usr/bin/env bash

# Configure lightdm autologin for a user.

set -e

user=${1:-$USER}

config=/etc/lightdm/lightdm.conf

if ! test -f "$config"; then
	echo "Missing config file $config" >&2
	exit 1
fi

# usage: enable_line filename name [value]
enable_line() {
	sudo sed -i "/^#\?$1=/{ s/^#//; ${2:+s/=.*/=$2/;} }" "$config"
}

sudo groupadd -r autologin || true
sudo gpasswd -a "$user" autologin

enable_line pam-service
enable_line pam-autologin-service
enable_line autologin-user "$user"
enable_line autologin-user-timeout
enable_line session-wrapper
